<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingestro Importer Adapted for Product Data</title>
    <script src="https://unpkg.com/@getnuvo/importer-vanilla-js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        .importer {
            height: 80vh; 
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
        }
        .bug-section {
            background-color: #ffe0b2;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 5px solid #ff9800;
        }
    </style>
</head>
<body>

    <h1>Ingestro Importer - Adapted Configuration</h1>
    <p>This configuration is adapted for the **Company ID** and **Company Name** fields found in your attached data (e.g., 'Product Data' sheet).</p>
    
    <div class="bug-section">
        <strong>Bug Note:</strong> The code below **excludes** the problematic `uploadStep` to ensure the multi-sheet file is correctly recognized as a single upload.
        <pre>
// CODE THAT CAUSES THE BUG (EXCLUDED):
stepHandler: {
    uploadStep: async ({ parsedData, rawData, updateData }) => {
        updateData(parsedData); 
    }
},</pre>
    </div>

    <div class="importer"></div>

    <script type="module">
        // Import the launch function from the vanilla JS module
        import { launchNuvoImporter } from "https://unpkg.com/@getnuvo/importer-vanilla-js@3.3.1/dist/index.esm.js";

        launchNuvoImporter(".importer", {
            licenseKey: "j6qRvDYNqWWyZ38n8r4kKTfvKscZautvJ4tO5ebQnU8=", // 
            settings: {
                developerMode: true,
                identifier: "company_product_data", // Updated identifier for clarity
                multipleFileUpload: true, // Necessary for multi-sheet/multi-file processing
                columns: [
                    {
                        // Mapped to 'Company ID' in the Product Data sheet
                        label: "Company ID", 
                        key: "company_id",
                        required: true,
                    },
                    {
                        // Mapped to 'Company Name' in the Product Data sheet
                        label: "Company Name", 
                        key: "company_name",
                        required: true,
                    },
                ],
            },
            
            // --- Custom Hooks (Adapted to use new keys) ---

            // Custom transformation applied to a specific column's values 
            columnHooks: {
                // Now targeting 'company_name'
                company_name: (values) => {
                    // Prepends "#NU-" to every company name value
                    return values.map(([item, index]) => [{ value: "#NU-" + item.value }, index]);
                },
            },

            // Custom logic applied on change (e.g., user edits a cell)
            onEntryChange: (rows, logs) => {
                return rows.map((row) => {
                    return {
                        data: {
                            // Adds " on change" to the Company ID upon user change
                            company_id: { value: row.data.company_id.value + " on change" },
                        },
                        rowIndex: row.rowIndex,
                    };
                });
            },
            
            // Custom logic applied after mapping but before validation/hooks
            onEntryInit: (row, rowIndex) => {
                // Adds " on init" to the Company ID upon initial load
                return { company_id: { value: row.company_id + " on init" } };
            },

            // --- Lifecycle Hooks ---
            onCancel: () => {
                console.log("onCancel triggered.");
            },
            onResults: (result, errors, complete, logs, block) => {
                console.log("--- onResults Triggered ---");
                console.log("Final Result Data:", result);
                console.log("Error rows:", errors);
                console.log("Logs:", logs);
                
                // Final step: call complete()
                complete(); 
            },
        });
    </script>
</body>
</html>
